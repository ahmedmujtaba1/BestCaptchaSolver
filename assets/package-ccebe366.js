const N={};function j(t){N.context=t}const G=(t,e)=>t===e,A={equals:G};let q=F;const h=1,S=2,M={owned:null,cleanups:null,context:null,owner:null};var f=null;let p=null,o=null,i=null,a=null,x=0;function z(t,e){const s=o,n=f,r=t.length===0,u=r?M:{owned:null,cleanups:null,context:null,owner:e===void 0?n:e},l=r?t:()=>t(()=>w(()=>k(u)));f=u,o=null;try{return b(l,!0)}finally{o=s,f=n}}function B(t,e){e=e?Object.assign({},A,e):A;const s={value:t,observers:null,observerSlots:null,comparator:e.equals||void 0},n=r=>(typeof r=="function"&&(r=r(s.value)),D(s,r));return[O.bind(s),n]}function J(t,e,s){const n=T(t,e,!1,h);v(n)}function H(t,e,s){q=V;const n=T(t,e,!1,h);n.user=!0,a?a.push(n):v(n)}function g(t,e,s){s=s?Object.assign({},A,s):A;const n=T(t,e,!0,0);return n.observers=null,n.observerSlots=null,n.comparator=s.equals||void 0,v(n),O.bind(n)}function w(t){if(o===null)return t();const e=o;o=null;try{return t()}finally{o=e}}function K(t){H(()=>w(t))}function I(t){const e=g(t),s=g(()=>C(e()));return s.toArray=()=>{const n=s();return Array.isArray(n)?n:n!=null?[n]:[]},s}function O(){const t=p;if(this.sources&&(this.state||t))if(this.state===h||t)v(this);else{const e=i;i=null,b(()=>m(this),!1),i=e}if(o){const e=this.observers?this.observers.length:0;o.sources?(o.sources.push(this),o.sourceSlots.push(e)):(o.sources=[this],o.sourceSlots=[e]),this.observers?(this.observers.push(o),this.observerSlots.push(o.sources.length-1)):(this.observers=[o],this.observerSlots=[o.sources.length-1])}return this.value}function D(t,e,s){let n=t.value;return(!t.comparator||!t.comparator(n,e))&&(t.value=e,t.observers&&t.observers.length&&b(()=>{for(let r=0;r<t.observers.length;r+=1){const u=t.observers[r],l=p&&p.running;l&&p.disposed.has(u),(l&&!u.tState||!l&&!u.state)&&(u.pure?i.push(u):a.push(u),u.observers&&L(u)),l||(u.state=h)}if(i.length>1e6)throw i=[],new Error},!1)),e}function v(t){if(!t.fn)return;k(t);const e=f,s=o,n=x;o=f=t,P(t,t.value,n),o=s,f=e}function P(t,e,s){let n;try{n=t.fn(e)}catch(r){return t.pure&&(t.state=h,t.owned&&t.owned.forEach(k),t.owned=null),t.updatedAt=s+1,R(r)}(!t.updatedAt||t.updatedAt<=s)&&(t.updatedAt!=null&&"observers"in t?D(t,n):t.value=n,t.updatedAt=s)}function T(t,e,s,n=h,r){const u={fn:t,state:n,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:e,owner:f,context:null,pure:s};return f===null||f!==M&&(f.owned?f.owned.push(u):f.owned=[u]),u}function E(t){const e=p;if(t.state===0||e)return;if(t.state===S||e)return m(t);if(t.suspense&&w(t.suspense.inFallback))return t.suspense.effects.push(t);const s=[t];for(;(t=t.owner)&&(!t.updatedAt||t.updatedAt<x);)(t.state||e)&&s.push(t);for(let n=s.length-1;n>=0;n--)if(t=s[n],t.state===h||e)v(t);else if(t.state===S||e){const r=i;i=null,b(()=>m(t,s[0]),!1),i=r}}function b(t,e){if(i)return t();let s=!1;e||(i=[]),a?s=!0:a=[],x++;try{const n=t();return Q(s),n}catch(n){s||(a=null),i=null,R(n)}}function Q(t){if(i&&(F(i),i=null),t)return;const e=a;a=null,e.length&&b(()=>q(e),!1)}function F(t){for(let e=0;e<t.length;e++)E(t[e])}function V(t){let e,s=0;for(e=0;e<t.length;e++){const n=t[e];n.user?t[s++]=n:E(n)}for(N.context&&j(),e=0;e<s;e++)E(t[e])}function m(t,e){const s=p;t.state=0;for(let n=0;n<t.sources.length;n+=1){const r=t.sources[n];r.sources&&(r.state===h||s?r!==e&&(!r.updatedAt||r.updatedAt<x)&&E(r):(r.state===S||s)&&m(r,e))}}function L(t){const e=p;for(let s=0;s<t.observers.length;s+=1){const n=t.observers[s];(!n.state||e)&&(n.state=S,n.pure?i.push(n):a.push(n),n.observers&&L(n))}}function k(t){let e;if(t.sources)for(;t.sources.length;){const s=t.sources.pop(),n=t.sourceSlots.pop(),r=s.observers;if(r&&r.length){const u=r.pop(),l=s.observerSlots.pop();n<r.length&&(u.sourceSlots[l]=n,r[n]=u,s.observerSlots[n]=l)}}if(t.owned){for(e=0;e<t.owned.length;e++)k(t.owned[e]);t.owned=null}if(t.cleanups){for(e=0;e<t.cleanups.length;e++)t.cleanups[e]();t.cleanups=null}t.state=0,t.context=null}function W(t){return t instanceof Error||typeof t=="string"?t:new Error("Unknown error")}function R(t){throw t=W(t),t}function C(t){if(typeof t=="function"&&!t.length)return C(t());if(Array.isArray(t)){const e=[];for(let s=0;s<t.length;s++){const n=C(t[s]);Array.isArray(n)?e.push.apply(e,n):e.push(n)}return e}return t}function X(t,e){return w(()=>t(e||{}))}function Y(t){let e=!1;const s=t.keyed,n=g(()=>t.when,void 0,{equals:(r,u)=>e?r===u:!r==!u});return g(()=>{const r=n();if(r){const u=t.children,l=typeof u=="function"&&u.length>0;return e=s||l,l?w(()=>u(r)):u}return t.fallback},void 0,void 0)}function Z(t){let e=!1,s=!1;const n=(l,c)=>l[0]===c[0]&&(e?l[1]===c[1]:!l[1]==!c[1])&&l[2]===c[2],r=I(()=>t.children),u=g(()=>{let l=r();Array.isArray(l)||(l=[l]);for(let c=0;c<l.length;c++){const y=l[c].when;if(y)return s=!!l[c].keyed,[c,y,l[c]]}return[-1]},void 0,{equals:n});return g(()=>{const[l,c,y]=u();if(l<0)return t.fallback;const d=y.children,U=typeof d=="function"&&d.length>0;return e=s||U,U?w(()=>d(c)):d},void 0,void 0)}function _(t){return t}const $="1.7.0";export{_ as M,Y as S,z as a,J as b,B as c,X as d,g as e,Z as f,K as o,N as s,$ as v};
